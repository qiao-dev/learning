<!DOCTYPE html>
<html>
<head>
    <title>SPO JSOMæµ‹è¯•</title>
    <!-- å¼ºåˆ¶åŠ è½½SPOè„šæœ¬åº“ -->
    <script src="/_layouts/15/SP.Runtime.js" type="text/javascript"></script>
    <script src="/_layouts/15/SP.js" type="text/javascript"></script>
</head>
<body>
    <h1>SPO JSOMæµ‹è¯•é¡µé¢</h1>
    <div id="result"></div>

    <script type="text/javascript">
        // ç­‰å¾…SPOè„šæœ¬åŠ è½½å®Œæˆ
        _spBodyOnLoadFunctionNames.push("initTest");

        function initTest() {
            try {
                console.log("ğŸ” å¼€å§‹æµ‹è¯•JSOM...");
                var context = SP.ClientContext.get_current();
                var user = context.get_web().get_currentUser();
                context.load(user);
                
                context.executeQueryAsync(
                    function() {
                        var upn = user.get_loginName().replace("i:0#.f|membership|", "");
                        var name = user.get_title();
                        document.getElementById("result").innerHTML = `âœ… JSOMåŠ è½½æˆåŠŸï¼<br>ç”¨æˆ·ï¼š${name}<br>UPNï¼š${upn}`;
                        console.log("âœ… JSOMæµ‹è¯•æˆåŠŸ");
                    },
                    function(sender, args) {
                        document.getElementById("result").innerHTML = `âŒ JSOMåŠ è½½å¤±è´¥ï¼š${args.get_message()}`;
                        console.error("âŒ JSOMæµ‹è¯•å¤±è´¥ï¼š", args.get_message());
                    }
                );
            } catch (err) {
                document.getElementById("result").innerHTML = `âŒ ä»£ç æ‰§è¡Œé”™è¯¯ï¼š${err}`;
                console.error("âŒ ä»£ç æ‰§è¡Œé”™è¯¯ï¼š", err);
            }
        }
    </script>
</body>
</html>
